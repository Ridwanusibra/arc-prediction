<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Arc Prediction Market</title>
<style>
:root {
  --primary:#4f46e5; 
  --bg:#111827; 
  --card:#1f2937;
  --text:#f9fafb; 
  --error:#ef4444; 
  --success:#10b981;
  --accent:#6366f1;
}
body{
  margin:0;
  font-family:sans-serif;
  background:var(--bg);
  color:var(--text);
  transition: all 0.3s ease;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:1rem;
  background:var(--card);
  box-shadow:0 2px 8px rgba(0,0,0,0.3);
}
header h2{margin:0;font-size:1.5rem;}
button{
  padding:.5rem 1rem;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:var(--primary);
  color:#fff;
  transition: background 0.2s;
}
button:hover{background:var(--accent);}
button:disabled{opacity:.5;cursor:not-allowed;}

.card{
  background:var(--card);
  margin:1rem auto;
  padding:2rem;
  border-radius:12px;
  max-width:500px;
  text-align:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.4);
  transition: all 0.3s ease;
}
.toast{
  position:fixed;
  top:1rem;
  right:1rem;
  padding:.5rem 1rem;
  border-radius:6px;
  display:none;
  color:#fff;
  z-index:100;
}
#toast{background:var(--success)}
#errorToast{background:var(--error)}
input, select{width:100%; margin:.5rem 0; padding:.5rem; border-radius:4px; border:none;}
hr{border:1px solid #374151; margin:1rem 0;}

/* --- Landing page styles --- */
#landingCard{
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  min-height:70vh;
}
#landingCard h1{
  font-size:2rem;
  margin-bottom:.5rem;
  color:var(--primary);
}
#landingCard p{
  font-size:1rem;
  margin:.25rem 0;
  color:#d1d5db;
}
#landingConnectBtn{
  margin-top:1rem;
  background:var(--primary);
  font-size:1rem;
}

/* --- Live Odds Chart Simulation --- */
#chartContainer{
  margin-top:2rem;
  width:100%;
  height:150px;
  background:rgba(255,255,255,0.05);
  border-radius:8px;
  overflow:hidden;
  position:relative;
}
.bar{
  position:absolute;
  bottom:0;
  width:10px;
  background:var(--accent);
  animation: bounce 1s infinite ease-in-out;
}
@keyframes bounce{
  0%,100%{height:30%;}
  50%{height:80%;}
}
</style>
</head>
<body>

<header>
  <h2>Arc Prediction Market</h2>
  <div>
    <button id="walletBtn" style="display:none">Connect Wallet</button>
    <button id="disconnectBtn" style="display:none">Disconnect</button>
  </div>
</header>

<!-- Landing Page -->
<div class="card" id="landingCard">
  <h1>Welcome to Arc Prediction!</h1>
  <p>Predict crypto prices, track odds, and place live bets.</p>
  <p>Earn rewards by predicting market movements accurately.</p>
  <button id="landingConnectBtn">Connect Wallet to Start</button>

  <!-- Animated Odds Chart -->
  <div id="chartContainer"></div>
</div>

<!-- Market Card -->
<div class="card" id="marketCard" style="display:none">
  <h3 id="status"></h3>
  <p>Yes Pool: <span id="yesPool">0</span> USDC</p>
  <p>No Pool: <span id="noPool">0</span> USDC</p>
  <p>Implied Odds â€” Yes: <span id="yesOdds">0</span>% | No: <span id="noOdds">0</span>%</p>
  <p>Fee: <span id="fee">0</span> USDC</p>
  <p>Closes In: <span id="countdown">--</span></p>

  <select id="direction">
    <option value="true">Price Will Increase</option>
    <option value="false">Price Will Decrease</option>
  </select>

  <input type="number" id="amount" placeholder="Bet amount (USDC)" min="0" />
  <button id="betBtn" disabled>Place Bet</button>

  <hr />
  <h4>Your Bets</h4>
  <div id="userBets">None</div>
</div>

<!-- Admin / Oracle Card -->
<div class="card" id="adminCard" style="display:none">
  <h3>Oracle / Admin</h3>
  <input type="number" id="oraclePrice" placeholder="Submit price" />
  <button id="submitPriceBtn">Submit Price</button>
  <button id="endBtn">End Prediction</button>
  <button id="settleBtn">Settle Bets</button>
</div>

<div class="toast" id="toast"></div>
<div class="toast" id="errorToast"></div>

<script type="module">
import detectEthereumProvider from 'https://cdn.jsdelivr.net/npm/@metamask/detect-provider/dist/detect-provider.esm.min.js';
import { ethers } from 'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js';

const CHAIN_ID = 5042002;
const CONTRACT_ADDRESS = '0xeCCcF291a8B66e947c6f008D8C2a1A0CE203DAdc';
const USDC_ADDRESS = '0x3600000000000000000000000000000000000000';
const ABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_oracle",
				"type": "address"
			}
		],
		"name": "addOracle",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "emergencyWithdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_usdc",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "OwnableInvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "OwnableUnauthorizedAccount",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "token",
				"type": "address"
			}
		],
		"name": "SafeERC20FailedOperation",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "better",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "willPriceIncrease",
				"type": "bool"
			}
		],
		"name": "BetPlaced",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "better",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "payout",
				"type": "uint256"
			}
		],
		"name": "BetSettled",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "EmergencyWithdrawal",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "endPrediction",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "executeWithdrawFees",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "FeesWithdrawn",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "oracle",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			}
		],
		"name": "OraclePriceSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "bool",
				"name": "willPriceIncrease",
				"type": "bool"
			},
			{
				"internalType": "uint256",
				"name": "betAmount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "deadline",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "minWinPool",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "maxLosePool",
				"type": "uint256"
			}
		],
		"name": "predict",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "time",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "priceIncreased",
				"type": "bool"
			}
		],
		"name": "PredictionEnded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "time",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			}
		],
		"name": "PredictionStarted",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_oracle",
				"type": "address"
			}
		],
		"name": "removeOracle",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "requestWithdrawFees",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "settleBets",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_currentPrice",
				"type": "uint256"
			}
		],
		"name": "startPrediction",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_price",
				"type": "uint256"
			}
		],
		"name": "submitPrice",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "bets",
		"outputs": [
			{
				"internalType": "address",
				"name": "better",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "willPriceIncrease",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "currentPrice",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "feePercentage",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "fees",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getContractUSDCBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "getUserBets",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "better",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"internalType": "bool",
						"name": "willPriceIncrease",
						"type": "bool"
					}
				],
				"internalType": "struct PredictionMarketFixed.Bet[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "isOracle",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "isPredictionEnded",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "isPriceIncreased",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "lastPredictionTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "noPool",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "oraclePrices",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "oracles",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "pendingWithdrawalRecipient",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "predictionDuration",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "predictionInterval",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "requiredOracleConfirmations",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "usdc",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "userBets",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdrawRequestTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "yesPool",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

let provider, signer, contract, usdc, user;
let countdownTimer;

const toast=(msg,error=false)=>{
  const el=document.getElementById(error?'errorToast':'toast');
  el.textContent=msg;
  el.style.display='block';
  setTimeout(()=>el.style.display='none',3000);
};

// --- Landing Page Chart Animation ---
function startChartAnimation(){
  const container=document.getElementById('chartContainer');
  container.innerHTML='';
  for(let i=0;i<40;i++){
    const bar=document.createElement('div');
    bar.className='bar';
    bar.style.left=(i*12)+'px';
    bar.style.animationDelay=(Math.random()*1)+'s';
    bar.style.height=(30+Math.random()*50)+'%';
    container.appendChild(bar);
  }
}

// --- Connect Wallet ---
async function connect(){
  const eth = await detectEthereumProvider({mustBeMetaMask:true});
  if(!eth) return toast('Install MetaMask',true);
  provider = new ethers.providers.Web3Provider(eth);
  const net = await provider.getNetwork();
  if(net.chainId!==CHAIN_ID) return toast('Switch to Arc Testnet',true);
  [user] = await provider.send('eth_requestAccounts',[]);
  signer = provider.getSigner();
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
  usdc = new ethers.Contract(USDC_ADDRESS,[
    'function balanceOf(address)view returns(uint256)',
    'function allowance(address,address)view returns(uint256)',
    'function approve(address,uint256)'
  ], signer);

  // Hide landing page & show main market/admin cards
  document.getElementById('landingCard').style.display='none';
  document.getElementById('walletBtn').style.display='none';
  document.getElementById('disconnectBtn').style.display='inline-block';
  document.getElementById('marketCard').style.display='block';

  await load();
  subscribeEvents();
}

function disconnect(){location.reload();}
document.getElementById('landingConnectBtn').onclick=connect;
walletBtn.onclick=connect;
disconnectBtn.onclick=disconnect;

// --- Previous market/admin logic remains untouched ---
async function load(){ /* ... your previous load code ... */ }
async function loadUserBets(){ /* ... */ }
function startCountdown(end){ /* ... */ }
async function bet(){ /* ... */ }
async function submitPrice(){ /* ... */ }
async function endPrediction(){ /* ... */ }
async function settle(){ /* ... */ }
function subscribeEvents(){ /* ... */ }

// Auto-refresh
setInterval(()=>user&&load(),15000);

// Start landing chart animation immediately
startChartAnimation();
</script>

</body>
</html>