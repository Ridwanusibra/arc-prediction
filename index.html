<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Arc Prediction | Modern Market</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap">
<style>
:root {
  --primary: #6366f1; --primary-hover: #4f46e5;
  --bg: #030712; --card: #0f172a;
  --text: #f8fafc; --text-dim: #94a3b8;
  --success: #10b981; --error: #ef4444;
  --glass: rgba(15, 23, 42, 0.8);
}

body { margin:0; font-family:'Inter', sans-serif; background:var(--bg); color:var(--text); overflow-x:hidden; }

/* --- Pro Landing Page --- */
#landing {
  position: fixed; inset:0; z-index:1000;
  background: radial-gradient(circle at 50% -20%, #1e1b4b 0%, #030712 80%);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
}
#landing.hidden { opacity:0; pointer-events:none; transform: translateY(-50px) scale(1.05); }

.hero-content { text-align:center; max-width:900px; padding:2rem; z-index:2; }
.hero-content h1 { font-size: clamp(3rem, 12vw, 5.5rem); font-weight:800; line-height:0.9; letter-spacing:-0.05em; margin-bottom:1.5rem; background: linear-gradient(to bottom, #fff 40%, #6366f1); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.hero-content p { font-size:1.25rem; color:var(--text-dim); margin-bottom:3rem; max-width:550px; margin-inline:auto; line-height: 1.6; }

.cta-btn {
  padding:1.1rem 2.8rem; font-size:1.1rem; font-weight:600;
  background: var(--primary); color:white; border:none; border-radius:14px;
  cursor:pointer; transition:all 0.3s; box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
}
.cta-btn:hover { background: var(--primary-hover); transform:scale(1.02); box-shadow: 0 0 25px rgba(99, 102, 241, 0.4); }

/* Financial Ticker */
.ticker-wrap {
  width:100%; overflow:hidden; background: rgba(0,0,0,0.6);
  border-top:1px solid rgba(255,255,255,0.05); padding:18px 0;
  position:absolute; bottom:0; backdrop-filter: blur(10px);
}
.ticker { display:flex; white-space:nowrap; animation:ticker 50s linear infinite; }
.ticker-item { padding:0 3rem; font-size:0.85rem; border-right:1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 8px;}
.ticker-val { color: var(--success); font-weight:800; font-family: monospace; font-size: 1rem; }
@keyframes ticker { 0%{transform:translateX(0);} 100%{transform:translateX(-50%);} }

/* --- Main Interface --- */
header { display:flex; justify-content:space-between; padding:1rem 5%; background: var(--glass); backdrop-filter: blur(25px); border-bottom:1px solid rgba(255,255,255,0.08); align-items:center; position:sticky; top:0; z-index:500; }
.logo { font-weight:800; font-size:1.5rem; letter-spacing:-1.5px; display:flex; align-items:center; gap:10px; }
.logo-dot { width:12px; height:12px; background: var(--primary); border-radius:50%; box-shadow:0 0 15px var(--primary); }

.container { max-width:1200px; margin:3rem auto; padding:0 1.5rem; display:grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap:2rem; }
.card { background: var(--card); border: 1px solid rgba(255,255,255,0.05); padding:1.75rem; border-radius:24px; transition: 0.3s ease; }
.card:hover { border-color: var(--primary); background: #111b2e; transform: translateY(-4px); }

.market-header { display:flex; align-items:center; gap:1.25rem; margin-bottom:1.5rem; }
.market-image { width:60px; height:60px; border-radius:16px; object-fit:cover; border: 1px solid rgba(255,255,255,0.1); }
.status-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 99px; background: rgba(16, 185, 129, 0.15); color: var(--success); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

input { background:#030712; border:1px solid #334155; color:white; padding:1.1rem; border-radius:14px; margin:15px 0; width:100%; box-sizing:border-box; font-size:1rem; transition: 0.2s; }
input:focus { border-color: var(--primary); outline:none; background: #080c16; }

/* Activity Feed Popup */
#live-activity {
  position: fixed; bottom:30px; left:30px; background: #1e293b; border: 1px solid var(--primary);
  padding:12px 24px; border-radius:100px; font-size:0.9rem; display:flex; align-items:center; gap:12px;
  z-index:1000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display:none;
}
.pulse-dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; animation: pulse 1.5s infinite; }
@keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }

.toast { position:fixed; top:2rem; right:2rem; padding:1.2rem 2.5rem; border-radius:16px; z-index:2000; color:white; font-weight: 600; display:none; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
</style>
</head>
<body>

<canvas id="particle-bg" style="position:fixed; inset:0; z-index:0;"></canvas>

<div id="landing">
  <div class="hero-content">
    <h1>Predict. <br/>Trade. Win.</h1>
    <p>The global decentralized market for everything. High-stakes forecasting on sports, crypto, and world events with USDC.</p>
    <button class="cta-btn" id="landingConnectBtn">Launch Application</button>
  </div>
  <div class="ticker-wrap">
    <div class="ticker">
      <span class="ticker-item">US ELECTION: CANDIDATE A <span class="ticker-val">52%</span></span>
      <span class="ticker-item">BTC > $100k DEC <span class="ticker-val">68%</span></span>
      <span class="ticker-item">EPL: CHELSEA WIN <span class="ticker-val">34%</span></span>
      <span class="ticker-item">FED RATE CUT <span class="ticker-val">81%</span></span>
      <span class="ticker-item">ETH ETF INFLOW <span class="ticker-val">92%</span></span>
      <span class="ticker-item">US ELECTION: CANDIDATE A <span class="ticker-val">52%</span></span>
      <span class="ticker-item">BTC > $100k DEC <span class="ticker-val">68%</span></span>
    </div>
  </div>
</div>

<header>
  <div class="logo"><div class="logo-dot"></div> ARC PREDICT</div>
  <div style="display:flex; align-items:center; gap:20px;">
    <span id="walletAddress" style="font-family: monospace; color: var(--text-dim); font-size: 0.9rem;"></span>
    <button id="disconnectBtn" class="cta-btn" style="padding:0.6rem 1.4rem; display:none; background:#1e293b; font-size:0.85rem; border: 1px solid rgba(255,255,255,0.1);">Disconnect</button>
  </div>
</header>

<div id="app" style="display:none">
  <div class="container" id="marketsContainer"></div>
</div>

<div id="live-activity"><div class="pulse-dot"></div> <span id="activity-text">Bet 500 USDC on BTC</span></div>
<div class="toast" id="toast" style="background:var(--success)"></div>
<div class="toast" id="errorToast" style="background:var(--error)"></div>

<script type="module">
import { ethers } from 'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js';

const CHAIN_ID = 5042002; // Arc testnet
const CONTRACT_ADDRESS = '0xeCCcF291a8B66e947c6f008D8C2a1A0CE203DAdc';
const USDC_ADDRESS = '0x3600000000000000000000000000000000000000';
const CONTRACT_ABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_oracle",
				"type": "address"
			}
		],
		"name": "addOracle",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "emergencyWithdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_usdc",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "OwnableInvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "OwnableUnauthorizedAccount",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "token",
				"type": "address"
			}
		],
		"name": "SafeERC20FailedOperation",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "better",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "willPriceIncrease",
				"type": "bool"
			}
		],
		"name": "BetPlaced",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "better",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "payout",
				"type": "uint256"
			}
		],
		"name": "BetSettled",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "EmergencyWithdrawal",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "endPrediction",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "executeWithdrawFees",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "FeesWithdrawn",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "oracle",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			}
		],
		"name": "OraclePriceSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "bool",
				"name": "willPriceIncrease",
				"type": "bool"
			},
			{
				"internalType": "uint256",
				"name": "betAmount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "deadline",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "minWinPool",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "maxLosePool",
				"type": "uint256"
			}
		],
		"name": "predict",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "time",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "priceIncreased",
				"type": "bool"
			}
		],
		"name": "PredictionEnded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "time",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			}
		],
		"name": "PredictionStarted",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_oracle",
				"type": "address"
			}
		],
		"name": "removeOracle",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "requestWithdrawFees",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "settleBets",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_currentPrice",
				"type": "uint256"
			}
		],
		"name": "startPrediction",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_price",
				"type": "uint256"
			}
		],
		"name": "submitPrice",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "bets",
		"outputs": [
			{
				"internalType": "address",
				"name": "better",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "willPriceIncrease",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "currentPrice",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "feePercentage",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "fees",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getContractUSDCBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "getUserBets",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "better",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"internalType": "bool",
						"name": "willPriceIncrease",
						"type": "bool"
					}
				],
				"internalType": "struct PredictionMarketFixed.Bet[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "isOracle",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "isPredictionEnded",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "isPriceIncreased",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "lastPredictionTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "noPool",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "oraclePrices",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "oracles",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "pendingWithdrawalRecipient",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "predictionDuration",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "predictionInterval",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "requiredOracleConfirmations",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "usdc",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "userBets",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdrawRequestTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "yesPool",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

let provider, signer, contract, user;

/* TOASTS */
const toast = (msg,isError=false)=>{
  const el=document.getElementById(isError?'errorToast':'toast');
  el.textContent=msg; el.style.display='block';
  setTimeout(()=>el.style.display='none',4000);
};

/* UI SWITCH */
function onConnected(){
  document.getElementById('landing').style.display='none';
  document.getElementById('app').style.display='block';
  document.getElementById('disconnectBtn').style.display='inline-block';
  document.getElementById('walletAddress').innerText=user.slice(0,6)+'...'+user.slice(-4);
  loadMarkets();
  simulateActivity();
}

/* ========== CONNECT WALLET ========== */
async function connectWallet(){
  localStorage.removeItem('userDisconnected');
  if(!window.ethereum){ toast('Please install MetaMask',true); return; }

  try{
    provider = new ethers.providers.Web3Provider(window.ethereum);
    const network = await provider.getNetwork();
    if(network.chainId!==CHAIN_ID){
      await window.ethereum.request({method:'wallet_switchEthereumChain', params:[{chainId:'0x'+CHAIN_ID.toString(16)}]});
    }

    const accounts = await provider.send('eth_requestAccounts',[]);
    user = accounts[0];
    signer = provider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
    onConnected();
  } catch(e){ toast(e.message||'Wallet connection failed',true); console.error(e);}
}

/* ========== AUTO RECONNECT ========== */
window.addEventListener('load', async ()=>{
  if(!window.ethereum) return;
  const disconnected = localStorage.getItem('userDisconnected');
  if(disconnected==='true') return; // skip auto reconnect

  const accounts = await window.ethereum.request({method:'eth_accounts'});
  if(accounts.length){
    user = accounts[0];
    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
    onConnected();
  }
});

/* ========== DISCONNECT ========== */
document.getElementById('disconnectBtn').onclick = ()=>{
  localStorage.setItem('userDisconnected','true');
  location.reload();
};

document.getElementById('landingConnectBtn').onclick = connectWallet;

/* ========== SIMULATE LIVE ACTIVITY ========== */
function simulateActivity(){
  const actions=["bet 400 USDC on Trump","bet 2.5k USDC on ETH","claimed 800 USDC","placed a bet on Arsenal"];
  const activity=document.getElementById('live-activity');
  const text=document.getElementById('activity-text');
  setInterval(()=>{
    text.textContent=`Someone ${actions[Math.floor(Math.random()*actions.length)]}`;
    activity.style.display='flex';
    setTimeout(()=>activity.style.display='none',4000);
  },10000);
}

/* ========== GET LOGO ========== */
function getLogo(title){
  title = title.toLowerCase();
  if(title.includes('bitcoin')) return 'https://cryptologos.cc/logos/bitcoin-btc-logo.png';
  if(title.includes('ethereum')) return 'https://cryptologos.cc/logos/ethereum-eth-logo.png';
  if(title.includes('chelsea')) return 'https://upload.wikimedia.org/wikipedia/en/c/cc/Chelsea_FC.svg';
  if(title.includes('arsenal')) return 'https://upload.wikimedia.org/wikipedia/en/5/53/Arsenal_FC.svg';
  if(title.includes('trump')) return 'https://upload.wikimedia.org/wikipedia/commons/5/56/Donald_Trump_official_portrait.jpg';
  return `https://api.dicebear.com/7.x/identicon/svg?seed=${title}`;
}

/* ========== LOAD MARKETS ========== */
async function loadMarkets(){
  const container=document.getElementById('marketsContainer');
  container.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:5rem;color:var(--text-dim)">Loading decentralized data...</div>';
  try{
    const count=await contract.getMarketCount();
    container.innerHTML='';
    for(let i=0;i<count;i++){
      const m=await contract.getMarket(i);
      const card=document.createElement('div'); card.className='card';
      const img=getLogo(m.title);
      card.innerHTML=`
      <div class="market-header">
        <img src="${img}" class="market-image"/>
        <div style="flex:1">
          <div class="status-badge">${m.status}</div>
          <h3 style="margin:5px 0 0 0;font-size:1.15rem;letter-spacing:-0.5px">${m.title}</h3>
        </div>
      </div>
      <input type="number" id="input${i}" placeholder="USDC Amount"/>
      <button class="cta-btn" style="width:100%;padding:0.9rem;border-radius:12px;font-size:1rem;" id="btn${i}">Place Trade</button>
      `;
      container.appendChild(card);
      document.getElementById(`btn${i}`).onclick=()=>placeBet(i,document.getElementById(`input${i}`).value);
    }
  }catch(e){ container.innerHTML='<p>Market Sync Failed. Check Connection.</p>'; console.error(e); }
}

/* ========== PLACE BET (adapted to your ABI) ========== */
async function placeBet(id,amount){
  if(!amount||amount<=0) return toast('Enter valid USDC amount',true);
  try{
    const val = ethers.utils.parseUnits(amount,6);
    const now = Math.floor(Date.now()/1000);
    const duration = 3600; // example: 1hr deadline
    const minWinPool = 0; 
    const maxLosePool = 0;

    toast('Waiting for Wallet Signature...');
    const tx = await contract.predict(true,val,now+duration,minWinPool,maxLosePool);
    await tx.wait();
    toast('Transaction Successful!');
    loadMarkets();
  }catch(e){ toast(e.reason||'Transaction Rejected',true); console.error(e); }
}

/* ========== PARTICLE BACKGROUND ========== */
const canvas=document.getElementById('particle-bg'); const ctx=canvas.getContext('2d'); let w,h,particles=[];
function init(){ w=canvas.width=window.innerWidth; h=canvas.height=window.innerHeight; particles=Array.from({length:60},()=>({x:Math.random()*w,y:Math.random()*h,s:Math.random()*1.8,vx:Math.random()-0.5,vy:Math.random()-0.5})); }
function draw(){ ctx.clearRect(0,0,w,h); ctx.fillStyle="rgba(99,102,241,0.15)"; particles.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,p.s,0,Math.PI*2);ctx.fill(); p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>w)p.vx*=-1;if(p.y<0||p.y>h)p.vy*=-1;}); requestAnimationFrame(draw);}
init(); draw(); window.onresize=init;
</script>
</body>
</html>